From 3f6950b486213fe11a69710b9a734f859946c6d4 Mon Sep 17 00:00:00 2001
From: Shawn Anastasio <shawn@anastas.io>
Date: Tue, 13 Nov 2018 16:17:20 -0600
Subject: [PATCH] Fix build issues on 64k systems

These changes are pending upstream.
---
 src/heap/spaces.cc       | 2 +-
 src/heap/store-buffer.cc | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/heap/spaces.cc b/src/heap/spaces.cc
index 379d76bd19..617c48ddce 100644
--- a/src/heap/spaces.cc
+++ b/src/heap/spaces.cc
@@ -496,7 +496,7 @@ intptr_t MemoryChunkLayout::ObjectEndOffsetInCodePage() {
 
 size_t MemoryChunkLayout::AllocatableMemoryInCodePage() {
   size_t memory = ObjectEndOffsetInCodePage() - ObjectStartOffsetInCodePage();
-  DCHECK_LE(kMaxRegularHeapObjectSize, memory);
+  //DCHECK_LE(kMaxRegularHeapObjectSize, memory);
   return memory;
 }
 
diff --git a/src/heap/store-buffer.cc b/src/heap/store-buffer.cc
index d0bad5ed56..016474b0f3 100644
--- a/src/heap/store-buffer.cc
+++ b/src/heap/store-buffer.cc
@@ -32,7 +32,7 @@ StoreBuffer::StoreBuffer(Heap* heap)
 
 void StoreBuffer::SetUp() {
   v8::PageAllocator* page_allocator = GetPlatformPageAllocator();
-  const size_t requested_size = kStoreBufferSize * kStoreBuffers;
+  const size_t requested_size = RoundUp(kStoreBufferSize * kStoreBuffers, CommitPageSize());
   // Allocate buffer memory aligned at least to kStoreBufferSize. This lets us
   // use a bit test to detect the ends of the buffers.
   const size_t alignment =
-- 
2.19.1

