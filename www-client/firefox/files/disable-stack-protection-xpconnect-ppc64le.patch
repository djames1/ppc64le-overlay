# HG changeset patch
# User Cameron Kaiser <spectre@floodgap.com>
# Date 1544669528 28800
#      Wed Dec 12 18:52:08 2018 -0800
# Node ID c07ddf5c25c8a6aa9123c9bff14e414afc402d6d
# Parent  ef4f3c28e91ccdc6e563d5911a933692ffddffe4
Bug 1512162: Disable stack protection for a portion of XPConnect on ppc64le due to a compiler bug. r=

diff -r ef4f3c28e91c -r c07ddf5c25c8 js/xpconnect/src/XPCWrappedNative.cpp
--- a/js/xpconnect/src/XPCWrappedNative.cpp	Thu Dec 13 03:43:36 2018 +0200
+++ b/js/xpconnect/src/XPCWrappedNative.cpp	Wed Dec 12 18:52:08 2018 -0800
@@ -1,16 +1,22 @@
 /* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
 /* vim: set ts=8 sts=2 et sw=2 tw=80: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
 /* Wrapper object for reflecting native xpcom objects into JavaScript. */
 
+#if(__GNUC__ && __linux__ && __PPC64__ && _LITTLE_ENDIAN)
+// Stack protection generates incorrect code currently with gcc on ppc64le
+// (bug 1512162).
+#pragma GCC optimize("no-stack-protector")
+#endif
+
 #include "xpcprivate.h"
 #include "mozilla/jsipc/CrossProcessObjectWrappers.h"
 #include "nsWrapperCacheInlines.h"
 #include "XPCLog.h"
 #include "js/MemoryFunctions.h"
 #include "js/Printf.h"
 #include "jsfriendapi.h"
 #include "AccessCheck.h"
